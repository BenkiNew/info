###BASIC SYSTEM CONFIGURATION###

#INFO soft
cat /etc/redhat-release OR cat /etc/*-release
uname -a #info
uname -sr #kernel
uname -n #hostaname
hostnamectl #all info

#INFO hard
df -h #part use
top #Tasts/CPU/Memory/Swap
ps aux #Processes
free -h #memory

#locale ru_UA.utf8 /etc/locale.conf 
locale [-a] #list all lang
localectl set-locale LANG=ru_UA.utf8

#date/timezone
timedatectl list-timezones #list all zone
timedatectl set-timezone Europe/Kiev


#synchronization real-time clock /etc/chrony.conf
systemctl status chronyd
chronyc tracking
chronyc sources #источники 


#backup config
mkdir /etc/backupconf/
cp -r /etc/ssh /etc/backupconf/ #ssh conf
cp -r /etc/yum.repos.d /etc/backupconf #repo conf
cp -r /etc/pki /etc/backupconf #key red hat access

#HISTORY
nano /etc/bashrc #edit 

    HISTSIZE=   #unlimited
    HISTFILESIZE=  #unlimited
    HISTTIMEFORMAT="%d/%m/%y %T " #time
#HISTFILE=~/.bash_host_history #name savefile

source ~/.bashrc #use now
.bashrc #edit aliase add 
    alias cd..='cd ..' 
    alias sys='systemctl'
    ...

history -w #save history to root dir @bash_history
history > namefile #save to namefiles @history.txt

#SH скрипт @name.sh
chmod +x [name].sh
sh [name].sh

#subscription-manager RED HAT
yum -v repolist
subscription-manager list
subscription-manager repos
/var/log/rhsm/rhsm.log #log

#SELINUX OFF
getenforce #status @disable

echo "SELINUX=disabled" > /etc/sysconfig/selinux
echo "" >> /etc/sysconfig/selinux


#KERNAL #ELRepo link http://elrepo.org
grubby --default-kernel #search default kernel

rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org #key
rpm -Uvh http://www.elrepo.org/elrepo-release-[7.0-3].el7.elrepo.noarch.rpm  #repo

yum --disablerepo="*" --enablerepo="elrepo-kernel" list available #https://www.kernel.org/
yum --enablerepo=elrepo-kernel install kernel-ml

grub2-set-default 0 #ver.2
grub2-editenv list #@saved_entry=0

grub2-mkconfig -o /boot/grub2/grub.cfg #Regenerate grub conf

#alternativ
/etc/default/grub #GRUB_DEFAULT=0


#delete old kernel
yum install yum-utils
package-cleanup --oldkernels --count=[1]  #1 old kernel
rpm -q kernel #all old kernel


#YUM
yum clean all #Очистить кеш
rm -rf /var/cache/yum 
yum makecache #Пересоздать кеш
yum repolist
yum update


rm -f /etc/yum.repos.d/* #del all repo
///
root@hostaname:~#ls -l /etc/yum.repos.d/
total 0
///

#SOFT
yum install mc nano man man-pages man-pages-ru wget
yum install iftop htop atop #nide add epel repo
            
yum install net-tools bind-utils telnet NetworkManager-tui
            bzip2 gzip unzip zip openssh-clients


#BASH Подсветка командной строки
cat /etc/bashrc > /etc/bashrc.bak; \
cat  << EOF|base64 -d > /etc/bashrc
IyBkb24ndCBwdXQgZHVwbGljYXRlIGxpbmVzIGluIHRoZSBoaXN0b3J5LiBTZWUgYmFzaCgxKSBm
b3IgbW9yZSBvcHRpb25zCiMgLi4uIG9yIGZvcmNlIGlnbm9yZWR1cHMgYW5kIGlnbm9yZXNwYWNl
CkhJU1RDT05UUk9MPWlnbm9yZWR1cHM6aWdub3Jlc3BhY2UKCiMgYXBwZW5kIHRvIHRoZSBoaXN0
b3J5IGZpbGUsIGRvbid0IG92ZXJ3cml0ZSBpdApzaG9wdCAtcyBoaXN0YXBwZW5kCgojIGZvciBz
ZXR0aW5nIGhpc3RvcnkgbGVuZ3RoIHNlZSBISVNUU0laRSBhbmQgSElTVEZJTEVTSVpFIGluIGJh
c2goMSkKSElTVFNJWkU9MTAwMApISVNURklMRVNJWkU9MjAwMAoKIyBjaGVjayB0aGUgd2luZG93
IHNpemUgYWZ0ZXIgZWFjaCBjb21tYW5kIGFuZCwgaWYgbmVjZXNzYXJ5LAojIHVwZGF0ZSB0aGUg
dmFsdWVzIG9mIExJTkVTIGFuZCBDT0xVTU5TLgpzaG9wdCAtcyBjaGVja3dpbnNpemUKCiMgbWFr
ZSBsZXNzIG1vcmUgZnJpZW5kbHkgZm9yIG5vbi10ZXh0IGlucHV0IGZpbGVzLCBzZWUgbGVzc3Bp
cGUoMSkKWyAteCAvdXNyL2Jpbi9sZXNzcGlwZSBdICYmIGV2YWwgIiQoU0hFTEw9L2Jpbi9zaCBs
ZXNzcGlwZSkiCgojIHNldCB2YXJpYWJsZSBpZGVudGlmeWluZyB0aGUgY2hyb290IHlvdSB3b3Jr
IGluICh1c2VkIGluIHRoZSBwcm9tcHQgYmVsb3cpCmlmIFsgLXogIiRkZWJpYW5fY2hyb290IiBd
ICYmIFsgLXIgL2V0Yy9kZWJpYW5fY2hyb290IF07IHRoZW4KICAgIGRlYmlhbl9jaHJvb3Q9JChj
YXQgL2V0Yy9kZWJpYW5fY2hyb290KQpmaQoKIyBlbmFibGUgY29sb3Igc3VwcG9ydCBvZiBscyBh
bmQgYWxzbyBhZGQgaGFuZHkgYWxpYXNlcwppZiBbIC14IC91c3IvYmluL2RpcmNvbG9ycyBdOyB0
aGVuCiAgICB0ZXN0IC1yIH4vLmRpcmNvbG9ycyAmJiBldmFsICQoZGlyY29sb3JzIC1iKQogICAg
YWxpYXMgbHM9J2xzIC0tY29sb3I9YXV0bycKICAgIGFsaWFzIGRpcj0nZGlyIC0tY29sb3I9YXV0
bycKICAgIGFsaWFzIHZkaXI9J3ZkaXIgLS1jb2xvcj1hdXRvJwogICAgYWxpYXMgZ3JlcD0nZ3Jl
cCAtLWNvbG9yPWF1dG8nCiAgICBhbGlhcyBmZ3JlcD0nZmdyZXAgLS1jb2xvcj1hdXRvJwogICAg
YWxpYXMgZWdyZXA9J2VncmVwIC0tY29sb3I9YXV0bycKZmkKCiMgQWxpYXMgZGVmaW5pdGlvbnMu
CmlmIFsgLWYgfi8uYmFzaF9hbGlhc2VzIF07IHRoZW4KICAgIC4gfi8uYmFzaF9hbGlhc2VzCmZp
CgojTWFuIGNvbG9yaXplCmV4cG9ydCBMRVNTX1RFUk1DQVBfbWI9JCdcRVswMTszMW0nICAgICAg
ICMgYmVnaW4gYmxpbmtpbmcKZXhwb3J0IExFU1NfVEVSTUNBUF9tZD0kJ1xFWzAxOzM4OzU7NzRt
JyAgIyBiZWdpbiBib2xkCmV4cG9ydCBMRVNTX1RFUk1DQVBfbWU9JCdcRVswbScgICAgICAgICAg
ICMgZW5kIG1vZGUKZXhwb3J0IExFU1NfVEVSTUNBUF9zZT0kJ1xFWzBtJyAgICAgICAgICAgIyBl
bmQgc3RhbmRvdXQtbW9kZQpleHBvcnQgTEVTU19URVJNQ0FQX3NvPSQnXEVbMzg7NTsyNDZtJyAg
ICAjIGJlZ2luIHN0YW5kb3V0LW1vZGUgLSBpbmZvIGJveApleHBvcnQgTEVTU19URVJNQ0FQX3Vl
PSQnXEVbMG0nICAgICAgICAgICAjIGVuZCB1bmRlcmxpbmUKZXhwb3J0IExFU1NfVEVSTUNBUF91
cz0kJ1xFWzA0OzM4OzU7MTQ2bScgIyBiZWdpbiB1bmRlcmxpbmUKCiNjb2xvcj0nMzEnICMgUmVk
CiNjb2xvcj0nMzInICMgR3JlZW4KI2NvbG9yPSczMycgIyBZZWxsb3cKI2NvbG9yPSczNCcgIyBC
bHVlCiNjb2xvcj0nMzUnICMgUHVycGxlCiNjb2xvcj0nMzYnICMgQ3lhbgojY29sb3I9JzM3JyAj
IFdoaXRlCgppZiBbICIkKHdob2FtaSkiICE9ICdyb290JyBdOyB0aGVuCiAgIGNvbG9yPSczNicK
ZWxzZQogICBjb2xvcj0nMzUnCmZpCgpleHBvcnQgUFMxPSdcW1wwMzNbMDE7JyR7Y29sb3J9J21c
XVx1QFxoXFtcMDMzWzAwbVxdOlxbXDAzM1swMTszNm1cXVx3XFtcMDMzWzAwbVxdXCQgJwo=
EOF


#FIREWALL

yum install firewalld #install
systemctl enable firewalld
systemctl start firewalld

firewall-cmd --state #status
firewall-cmd --get-default-zone #default zone @public
firewall-cmd --list-all #activ service

#firewall-cmd --zone=public --remove-service=dhcpv6-client --permanent #Do not delete if you use ipv6
firewall-cmd --zone=public --remove-service=ssh --permanent
firewall-cmd --reload

firewall-cmd --zone=public --permanent --add-port=3434/tcp #port ssh

#SSH 
/etc/ssh/sshd_config


Port [xxxx] #edit port @3434
AllowUsers [user] #@ec2-user
PermitRootLogin no #no root access login
    
    echo $?
    
    ss -tnlp | grep ssh
        ///AWS #Security Groups add rule @port///


#EPEL repo  @https://dl.fedoraproject.org/pub/epel/ @http://fedoraproject.org/wiki/EPEL#How_can_I_use_these_extra_packages
yum install wget
wget https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm
     
rpm -Uvh epel-release-latest-7*.rpm

#alternative add repo EPEL
touch /etc/yum.repos.d/epel.repo #new --> edit file

[epel]
name=Extra Packages for Enterprise Linux 7 - $basearch
#baseurl=http://download.fedoraproject.org/pub/epel/7/$basearch
metalink=https://mirrors.fedoraproject.org/metalink?repo=epel-7&arch=$basearch
failovermethod=priority
enabled=1
gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-7
exclude = nginx*
keepcache = 0

[epel-debuginfo]
name=Extra Packages for Enterprise Linux 7 - $basearch - Debug
#baseurl=http://download.fedoraproject.org/pub/epel/7/$basearch/debug
metalink=https://mirrors.fedoraproject.org/metalink?repo=epel-debug-7&arch=$basearch
failovermethod=priority
enabled=0
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-7
gpgcheck=1

[epel-source]
name=Extra Packages for Enterprise Linux 7 - $basearch - Source
#baseurl=http://download.fedoraproject.org/pub/epel/7/SRPMS
metalink=https://mirrors.fedoraproject.org/metalink?repo=epel-source-7&arch=$basearch
failovermethod=priority
enabled=0
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-7
gpgcheck=1    
        

#SWAP file
    swapon --show #info
    free -h
    df -h
        /dev/[part]        XXG  XXG   XXG  XX%
    
    fallocate -l [size] /swapfile #reserve swop
    ls -lh /swapfile #check
    
    chown root:root /swapfile
    chmod 600 /swapfile #root access
        ls -lh /swapfile
        -rw------- 1 root root [size] /swapfile
    mkswap /swapfile
    swapon /swapfile #enable
    swapon --show #check
    
    ///ver.2
    dd if=/dev/zero of=/swapfile bs=1M count=[size] #@1024
    chmod 600 /swapfile && sudo mkswap /swapfile
    swapoff -a
    swapon /swapfile
    echo "/swapfile swap swap defaults 0 0"| sudo tee -a /etc/fstab #avtostart
    echo "vm.swappiness=30"| sudo tee -a /etc/sysctl.conf #срабатівает при 30% значении
    reboot

    mount | grep " / "  #type part
    

#SWAP part
lsblk -l #all disk part

mkswap /dev/[part] #add part @xvdb
swapon /dev/[part] #enable part
swapon -s #status

lsblk -no UUID /dev/[part] #check UUID
    blkid #check UUID

echo "UUID=[UUID swap part] swap swap defaults 0 0"| tee -a /etc/fstab #active part to system start
grep -i --color swap /proc/meminfo #color swap use 

echo "vm.swappiness=[30]"| tee -a /etc/sysctl.conf #active swap to use ower @30% ram
sysctl -f #activite now
cat /proc/sys/vm/swappiness #actual %%



#ERRORS
systemctl --state=failed [--all] #check error service
systemctl list-unit-files #status service
systemctl list-unit-files | grep enabled #stus @enable


#AWS
@yum remove cloud-init
@kdump service remove

#remove servise and restart systemctl
systemctl stop [servicename]
systemctl disable [servicename]
#rm /etc/systemd/system/[servicename]
#rm /etc/systemd/system/[servicename] symlinks that might be related
systemctl daemon-reload
systemctl reset-failed

#TEST
yum install stress

stress -c 4## Stress using CPU-bound task
stress -i 2## Stress using IO-bound task
stress --vm 1 --vm-bytes [size] #memory/swap @M or G
    ex. stress --cpu 8 --io 4 --vm 2 --vm-bytes 512M --timeout 10s #time work @s


#HTTP(s)  ///AWS #Security Groups add rule @port///
firewall-cmd --permanent --zone=public --add-service=http
firewall-cmd --permanent --zone=public --add-service=https
firewall-cmd --reload
systemctl status network -l #status


#HOSTNAME
nmtui #edit hostname @benkinew.info

#NGINX @https://brouken.com/brouken-centos-7-repo/
yum -y install yum-utils
yum-config-manager --add-repo https://brouken.com/brouken.repo
yum-config-manager --save --setopt=epel.exclude=nginx*; # Additional highly recommended configuration (if you’re using EPEL!):

yum install nginx

enable/start/status

nginx -t #work
netstat -tulpn | grep nginx #port use


#WWW
    ping -c4 hostname #@benkinew.info
edit DNS domen #Elastic IP AWS


useradd [name] #@benkinew
mkdir -p /var/www/benkinew.info/public_html #create www dir
nano /var/www/benkinew.info/public_html/index.html #test text @hello wolrd!!!
chown -R benkinew:benkinew /var/www/benkinew.info/public_html/ #access dir
chmod 755 /var/www/benkinew.info/public_html/ #access dir


@https://certbot.eff.org/#centosrhel7-nginx
yum -y install yum-utils
yum-config-manager --enable rhui-REGION-rhel-server-extras rhui-REGION-rhel-server-optional #AWS 
yum install certbot-nginx #install carbon menedger
    nano /etc/yum/pluginconf.d/search-disabled-repos.conf #only aske @notify_only=0
    
certbot --nginx -d [benkinew.info] -d [www.benkinew.info] #install SSL from Let's Encrypt and answer questions
    
    openssl dhparam -out /etc/ssl/certs/dhparam.pem 4096 # add line nginx.conf ssl_dhparam /etc/ssl/certs/dhparam.pem;  
    
    certbot renew --dry-run #test automatic renewal
    certbot renew #enable autorenawal

    crontab -e #edit crontab aka VI
    15 3 * * * /usr/bin/certbot renew --quiet #last line @выполнить следующую команду в 3:15 утра, каждый день

@https://globalsign.ssllabs.com #ckeks ssl sert



#SFTP
find / -name sftp-server
sudo /usr/libexec/openssh/sftp-server #WinSCP
ssh port 22 #add AWS only




    

    
    












